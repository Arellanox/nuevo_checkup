<style>
  .img1 {
      width: 200px; /* Ajusta según tu imagen */
      height: 600px;
      display: block;
  }
  .highlight {
      position: absolute;
      background-color: rgba(255, 0, 0, 0.7); /* Color de sombreado rojo */
      pointer-events: none; /* No interfiere con el mouse */
      display: none; /* Oculto inicialmente */
  }
  .highlight-selected {
    position: absolute;
    background: rgba(255, 0, 0, 0.5); /* Sombreado rojo */
    pointer-events: none; /* No interfiere con el mouse */
    display: none;
    border-radius: 50%;
  }
  .tooltip {
      position: absolute;
      background-color: rgba(0, 0, 0, 0.7);
      color: white;
      padding: 5px;
      border-radius: 5px;
      display: none; /* Oculto inicialmente */
      font-size: 12px;
  }
  .container {
      position: relative;
      display: inline-block;
  }
</style>

<body>
    <!-- Modal de Bootstrap -->
<div class="modal fade" id="bodyPartModal" tabindex="-1" aria-labelledby="modalTitle" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="modalTitle"></h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <form id="injuryForm">
            <div class="mb-3">
              <label for="injuryDescription" class="form-label">Descripción de la lesión</label>
              <textarea class="form-control" name="lesiones" id="injuryDescription" rows="3"></textarea>
            </div>
            <button type="button" class="btn btn-primary" id="injuryButton">Guardar</button>
          </form>
        </div>
      </div>
    </div>
</div>
<div class="container">
    <div class="row">
        <div class="col-2 justify-content-center" id="silueta_frontal">
            <img src="silueta.jpg" usemap="#body-map" alt="Silueta Humana" id="body-image" class="img">
            <div id="highlight" class="highlight"></div>
            <div id="tooltip" class="tooltip"></div> <!-- Tooltip -->
        </div>
        <!-- <div class="col-2">
          <img src="silueta_trasera.jpg" usemap="#siluetaTraseraMap" alt="Silueta Trasera" id="silueta_trasera" class="img">
          <div id="highlight-2"></div>
        </div>
        <div class="col-2">
          <img src="silueta_lateral.jpg" usemap="#siluetaLateralMap" alt="Silueta Lateral" id="silueta_lateral" class="img">
          <div id="highlight-3"></div>
        </div> -->
    </div>
    <div class="row">
      <div class="col-10" id="divDetalleLesiones">
          <!-- aqui se muestran los detalles de las lesiones -->
      </div>
    </div>
  
</div>

<map name="body-map">
  <!-- silueta frontal -->
  <area shape="circle" coords="105,37,30" alt="Cabeza" data-part="Cabeza" data-bs-toggle="tooltip" data-bs-placement="top" title="Cabeza" data-part-id="1">
  <area shape="circle" coords="103,92, 25" alt="Cuello" data-part="Cuello" data-part-id="2">
  <area shape="circle" coords="35,117,25" alt="Hombro Derecho" data-part="Hombro Derecho" data-part-id="18">
  <area shape="circle" coords="180,119,25" alt="Hombro Izquierdo" data-part="Hombro Izquierdo" data-part-id="19">
  <area shape="circle" coords="107,153,45" alt="Pecho" data-part="Pecho" data-part-id="20">
  <area shape="circle" coords="107,192,25" alt="Área del Diafragma" data-part="Área del Diafragma" data-part-id="21">
  <area shape="circle" coords="107,240,50" alt="Abdomen" data-part="Abdomen" data-part-id="11">
  <area shape="circle" coords="107,291,30"  alt="Zona Inguinal" data-part="Zona Inguinal" data-part-id="22">
  <area shape="circle" coords="30,182,20" alt="Brazo Derecho" data-part="Brazo Derecho" data-part-id="23">
  <area shape="circle" coords="28,257,20" alt="Antebrazo Derecho" data-part="Antebrazo Derecho" data-part-id="25">
  <area shape="circle" coords="180,184,20" alt="Brazo Izquierdo" data-part="Brazo Izquierdo" data-part-id="24">
  <area shape="circle" coords="185,257,20" alt="Antebrazo Izquierdo" data-part="Antebrazo Izquierdo" data-part-id="26">
  <area shape="circle" coords="30,332,20" alt="Mano Derecha" data-part="Mano Derecha" data-part-id="27">
  <area shape="circle" coords="180,333,20" alt="Mano Izquierda" data-part="Mano Izquierda" data-part-id="28">
  <area shape="circle" coords="75,358,35" alt="Muslo Derecho" data-part="Muslo Derecho" data-part-id="29">
  <area shape="circle" coords="135,358,35" alt="Muslo Izquierdo" data-part="Muslo Izquierdo" data-part-id="30">
  <area shape="circle" coords="85,438,20" alt="Rodilla Derecha" data-part="Rodillla Derecha" data-part-id="31">
  <area shape="circle" coords="130,438,20" alt="Rodilla Izquierda" data-part="Rodilla Izquierda" data-part-id="32">
  <area shape="circle" coords="90,496,30" alt="Pierna Derecha" data-part="Pierna Derecha" data-part-id="33">
  <area shape="circle" coords="134,496,30" alt="Pierna Izquierda" data-part="Pierna Izquierda" data-part-id="34">
  <area shape="circle" coords="95,549,12" alt="Tobillo Derecho" data-part="Tobillo Derecho" data-part-id="35">
  <area shape="circle" coords="120,549,12" alt="Tobillo Izquierdo" data-part="Tobiilo Izquierdo" data-part-id="36">
  <area shape="circle" coords="95,584,15" alt="Pie Derecho" data-part="Pie Derecho" data-part-id="37">
  <area shape="circle" coords="120,584,15" alt="Pie Izquierdo" data-part="Pie Izquierdo" data-part-id="38">

  <!-- silueta posterior -->
  <area shape="circle" coords="343,30,30" alt="Cabeza posterior" data-part="Cabeza Posterior" data-part-id="78">
  <area shape="circle" coords="341,68,25" alt="Cuello posterior" data-part="Cuello Posterior" data-part-id="79">
  <area shape="circle" coords="411,126,25" alt="Hombro derecho posterior" data-part="Hombro Derecho Posterior" data-part-id="80">
  <area shape="circle" coords="267,126,25" alt="Hombro izquierdo posterior" data-part="Hombro Izquierdo Posterior" data-part-id="81">
  <area shape="circle" coords="341,189,50" alt="Espalda" data-part="Espalda" data-part-id="82">
  <area shape="circle" coords="364,298,25" alt="Gluteo derecho" data-part="Gluteo Derecho" data-part-id="83">
  <area shape="circle" coords="317,298,25" alt="Gluteo izquierdo" data-part="Gluteo Izquierdo" data-part-id="84">
  <area shape="circle" coords="341,120,40" alt="Trapecio y Homóplatos" data-part="Trapecio y Homóplatos" data-part-id="85">
  <area shape="circle" coords="345,250,30" alt="Zona Lumbar" data-part="Zona Lumbar" data-part-id="86">
  <area shape="circle" coords="414,188,30" alt="Brazo Derecho Posterior" data-part="Brazo Derecho Posterior" data-part-id="87">
  <area shape="circle" coords="265,188,30" alt="Brazo Izquierdo Posterior" data-part="Brazo Izquierdo Posterior" data-part-id="88">
  <area shape="circle" coords="414,225,20" alt="Codo Derecho" data-part="Codo Derecho" data-part-id="89">
  <area shape="circle" coords="265,225,20" alt="Codo Izquierdo" data-part="Codo Izquierdo" data-part-id="90">
  <area shape="circle" coords="419,279,25" alt="Antebrazo Derecho Posterior" data-part="Antebrazo Derecho Posterior" data-part-id="91">
  <area shape="circle" coords="265,279,25" alt="Antebrazo Izquierdo Posterior" data-part="Antebrazo Izquierdo Posterior" data-part-id="92">
  <area shape="circle" coords="345,286,30" alt="Región Sacra" data-part="Región Sacra" data-part-id="93">
  <area shape="circle" coords="368,377,30" alt="Muslo Derecho Posterior" data-part="Muslo Derecho Posterior" data-part-id="94">
  <area shape="circle" coords="315,377,30" alt="Muslo Izquierdo Posterior" data-part="Muslo Izquierdo Posterior" data-part-id="95">
  <area shape="circle" coords="364,429,20" alt="Corva Derecha" data-part="Corva Derecha" data-part-id="96">
  <area shape="circle" coords="318,429,20" alt="Corva Izquierda" data-part="Corva Izquierda" data-part-id="97">
  <area shape="circle" coords="360,498,20" alt="Pantorrilla Derecha" data-part="Pantorrilla Derecha" data-part-id="98">
  <area shape="circle" coords="320,498,20" alt="Pantorrilla Izquierda" data-part="Pantorrilla Izquierda" data-part-id="99">
  <area shape="circle" coords="353,562,15" alt="Tobillo Derecho Posterior" data-part="Tobillo Derecho Posterior" data-part-id="100">
  <area shape="circle" coords="324,562,15" alt="Tobillo Izquierdo Posterior" data-part="Tobillo Izquierdo Posterior" data-part-id="101">
  <area shape="circle" coords="356,582,15" alt="Talón Derecho" data-part="Talón Derecho" data-part-id="102">
  <area shape="circle" coords="324,582,15" alt="Talón Izquierdo" data-part="Talón Izquierdo" data-part-id="103">

  <!-- silueta lateral -->
  <area shape="circle" coords="551,42,30" alt="Cabeza Lateral" data-part="Cabeza Lateral" data-part-id="104">
  <area shape="circle" coords="546,92,25" alt="Cuello Lateral" data-part="Cuello Lateral" data-part-id="105">
  <area shape="circle" coords="584,160,20" alt="Pecho Lateral" data-part="Pecho Lateral" data-part-id="106">
  <area shape="circle" coords="539,202,30" alt="Brazo Lateral" data-part="Brazo Lateral" data-part-id="107">
  <area shape="circle" coords="539,257,20" alt="Codo Lateral" data-part="Codo Lateral" data-part-id="108">
  <area shape="circle" coords="552,290,20" alt="Antebrazo Lateral" data-part="Antebrazo Lateral" data-part-id="109">
  <area shape="circle" coords="544,370,30" alt="Muslo Lateral" data-part="Muslo Lateral" data-part-id="110">
  <area shape="circle" coords="542,429,20" alt="Rodilla Lateral" data-part="Rodilla Lateral" data-part-id="111">
  <area shape="circle" coords="531,494,30" alt="Pierna Lateral" data-part="Pierna Lateral" data-part-id="112">
  <area shape="circle" coords="540,557,15" alt="Tobillo Lateral" data-part="Tobiilo Lateral" data-part-id="113">
  <area shape="circle" coords="564,583,17" alt="Pie Lateral" data-part="Pie Lateral" data-part-id="114">
</map>


<script>
  var areaSelected;
  var data_part_id;
  var modal;
  var tooltipTriggerList = document.querySelectorAll('[data-bs-toggle="tooltip"]');
  var tooltipList = [...tooltipTriggerList].map(tooltipTriggerEl => new bootstrap.Tooltip(tooltipTriggerEl));
  
  var highlight = document.getElementById('highlight');
  var areas = document.querySelectorAll('area');

  areas.forEach(area => {
      area.addEventListener('mouseover', function () {
          const coords = this.coords.split(',').map(Number);
          const shape = this.shape;
          const partName = this.getAttribute('data-part');

          // Ajustar el sombreado
          if (shape === 'circle') {
              const [x, y, r] = coords;
              highlight.style.width = `${2 * r}px`;
              highlight.style.height = `${2 * r}px`;
              highlight.style.borderRadius = '50%';
              highlight.style.left = `${x - r}px`;
              highlight.style.top = `${y - r}px`;
          } else if (shape === 'rect') {
              const [x1, y1, x2, y2] = coords;
              highlight.style.width = `${x2 - x1}px`;
              highlight.style.height = `${y2 - y1}px`;
              highlight.style.borderRadius = '0';
              highlight.style.left = `${x1}px`;
              highlight.style.top = `${y1}px`;
          } else if (shape === 'poly') {
              console.warn('Sombreado de polígonos no implementado en este ejemplo.');
          }

          highlight.style.position = 'absolute';
          highlight.style.display = 'block';
      });

      area.addEventListener('mouseout', function () {
          highlight.style.display = 'none';
          tooltip.style.display = 'none';  // Ocultar tooltip
      });
  });

  $(document).ready(function(){
    var areas = document.querySelectorAll('area');

    // Añadir evento de clic a cada área
    areas.forEach(area => {
        area.addEventListener('click', function (event) {
            // Evitar el comportamiento predeterminado del clic
            event.preventDefault();
            // Obtener el valor del atributo data-part
            var partName = this.getAttribute('data-part');
            data_part_id = this.getAttribute('data-part-id');
            areaSelected = area;
            // Establecer el título del modal dinámicamente
            document.getElementById('modalTitle').innerText = partName;


            // Mostrar el modal
            modal = new bootstrap.Modal(document.getElementById('bodyPartModal'));
            modal.show();
        });
    });

    // viewport
    // Selecciona la sección específica
    var targetSection = document.getElementById('MarcacionAreas');

    // Crea un observador
    var observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                console.log('Sección lesionesCuerpo visible');
                pintarAreasLesionadas();
            }
        });
    }, {
        root: null, // Usa el viewport como referencia
        threshold: 0.1 // La función se dispara cuando el 10% de la sección es visible
    });

    // Observa la sección
    observer.observe(targetSection);

  })

  $('#injuryButton').on('click', function(event){
    event.stopPropagation();
    event.stopImmediatePropagation();
    var form = new FormData(document.getElementById('injuryForm'));
    form.set('api', 12);
    form.set('turno_id', pacienteActivo.array['ID_TURNO']);
    form.set('part_id', data_part_id);
    $.ajax({
        data: form,
        url: `${http}${servidor}/${appname}/api/ficha_admision_api.php`,
        type: "POST",
        processData: false,
        contentType: false,
        dataType: 'json',
        beforeSend: function () {
        alertToast('Guardando...', 'info');
        },
        success: function (data) {
        if (!isNaN(data.response.data)) {
            alertToast('Guardado con éxito', 'success');
            $('#injuryDescription').val('');
            modal.hide();
            activarAreaSeleccionadaCuerpo(areaSelected)
            pintarDetalleLesiones()
        } else {
            alertToast(`Error al guardar: ${data.response.data}`, 'danger');
        }
        }
    })
  })


  function pintarAreasLesionadas(){
    $.ajax({
      url: `${http}${servidor}/${appname}/api/ficha_admision_api.php`,
      data: {
        api: 13,
        turno_id: pacienteActivo.array['ID_TURNO'],
      },
      type: "POST",
      dataType: "json",
      success: function(data){
        llenarLesionesSigma(data.response.data);
        mostrarDetalleLesionSigma(data.response.data);
      },
      error: function(jqXHR, exception, data){
        alertErrorAJAX(jqXHR, exception, data );
      }
    })
  }


  function pintarDetalleLesiones(){
     // recuperar el detalle de las lesiones de sigma
     $.ajax({
      url: `${http}${servidor}/${appname}/api/ficha_admision_api.php`,
      data: {
        api: 13,
        turno_id: pacienteActivo.array['ID_TURNO'],
      },
      type: "POST",
      dataType: "json",
      success: function(data){
        mostrarDetalleLesionSigma(data.response.data);
      },
      error: function(jqXHR, exception, data){
        alertErrorAJAX(jqXHR, exception, data );
      }
    })
  }

</script>
</body>