<div class="modal fade" id="modalPacienteAceptar" tabindex="-1" aria-labelledby="filtrador" aria-hidden="true"
     data-bs-backdrop="static" data-bs-focus="false" data-bs-keyboard="false">
    <div class="modal-dialog modal-xl modal-fullscreen modal-dialog-centered modal-dialog-scrollable">
        <div class="modal-content">
            <div class="modal-header header-modal">
                <h5 class="modal-title" id="title-paciente_aceptar">Nombre paciente</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form class="" id="formAceptarPacienteRecepcion">
                    <div class="row">
                        <div class="col-12 text-center">
                            <p>Acepte, cargue y añada los estudios e información correspondiente al paciente.</p>
                        </div>
                        <div id="tooltip" style="max-width: max-content;">
                            <div class="modal-body">

                                <div id="container-label">
                                    Espere un momento...
                                </div>

                                <div id="container-estudios" style="display: none;">
                                    <h5>Estudio(s): </h5>
                                    <ul class="list-group" id="listaContenidoEstudios"></ul>
                                    <hr>
                                </div>
                                <div id="container-grupos" style="display: none;">
                                    <h5>Grupo(s): </h5>
                                    <ul class="list-group" id="listContenidoGrupos"></ul>
                                </div>

                            </div>
                        </div>

                        <div class="col-12 col-md-8 FirstPage-aceptar">
                            <h4 class="mt-2">Cargar estudios</h4>
                            <p>Agrege nuevos estudios agregar, solo los estudios con precios al cliente aparecerán</p>
                            <div class="accordion" id="accordionExample">
                                <div class="accordion-item">
                                    <h2 class="accordion-header" id="headingOne">
                                        <button class="accordion-button" type="button" data-bs-toggle="collapse"
                                                data-bs-target="#collapseOne" aria-expanded="true"
                                                aria-controls="collapseOne">
                                            Estudios de Laboratorio Clínico
                                        </button>
                                    </h2>
                                    <div id="collapseOne" class="accordion-collapse collapse show"
                                         aria-labelledby="headingOne">
                                        <div class="accordion-body">
                                            <div class="row">
                                                <div class="col-6">
                                                    <div class="row">
                                                        <div class="col-12 contenido_estudio">

                                                            <select class="" id="select-lab">
                                                            </select>

                                                        </div>
                                                        <div class="col-12">
                                                            <button type="button" class="btn btn-confirmar"
                                                                    id="btn-AgregarEstudioLab">
                                                                <i class="bi bi-person-badge"></i> Agregar
                                                            </button>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="col-6">
                                                    <ul class="list-group" id="list-estudios-laboratorio">
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="accordion-item">
                                    <h2 class="accordion-header" id="headingTwo">
                                        <button class="accordion-button collapsed" type="button"
                                                data-bs-toggle="collapse"
                                                data-bs-target="#collapseSix" aria-expanded="true"
                                                aria-controls="collapseSix">

                                            Estudios de Laboratorio Biomolecular
                                        </button>
                                    </h2>
                                    <div id="collapseSix" class="accordion-collapse collapse"
                                         aria-labelledby="headingTwo">
                                        <div class="accordion-body">
                                            <div class="accordion-body">
                                                <div class="row">
                                                    <div class="col-6">
                                                        <div class="row">
                                                            <div class="col-12">
                                                                <select class="" id="select-labbio">
                                                                </select>
                                                            </div>
                                                            <div class="col-12">
                                                                <button type="button" class="btn btn-confirmar"
                                                                        id="btn-AgregarEstudioLabBio">
                                                                    <i class="bi bi-person-badge"></i> Agregar
                                                                </button>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="col-6">
                                                        <ul class="list-group"
                                                            id="list-estudios-laboratorio-biomolecular">
                                                        </ul>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="accordion-item">
                                    <h2 class="accordion-header" id="headingTwo">
                                        <button class="accordion-button collapsed" type="button"
                                                data-bs-toggle="collapse"
                                                data-bs-target="#collapseTwo" aria-expanded="false"
                                                aria-controls="collapseTwo">
                                            Estudios de Rayos X
                                        </button>
                                    </h2>
                                    <div id="collapseTwo" class="accordion-collapse collapse"
                                         aria-labelledby="headingTwo">
                                        <div class="accordion-body">
                                            <div class="row">
                                                <div class="col-6">
                                                    <div class="row">
                                                        <div class="col-12">
                                                            <select class="" id="select-rx">
                                                            </select>
                                                        </div>
                                                        <div class="col-12">
                                                            <button type="button" class="btn btn-confirmar"
                                                                    id="btn-agregarEstudioRX">
                                                                <i class="bi bi-person-badge"></i> Agregar
                                                            </button>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="col-6">
                                                    <ul class="list-group" id="list-estudios-rx">
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="accordion-item">
                                    <h2 class="accordion-header" id="headingThree">
                                        <button class="accordion-button collapsed" type="button"
                                                data-bs-toggle="collapse"
                                                data-bs-target="#collapseThree" aria-expanded="false"
                                                aria-controls="collapseThree">
                                            Estudios de Ultrasonido
                                        </button>
                                    </h2>
                                    <div id="collapseThree" class="accordion-collapse collapse"
                                         aria-labelledby="headingThree">
                                        <div class="accordion-body">
                                            <div class="row">
                                                <div class="col-6">
                                                    <div class="row">
                                                        <div class="col-12">
                                                            <select class="" id="select-us">
                                                            </select>
                                                        </div>
                                                        <div class="col-12">
                                                            <button type="button" class="btn btn-confirmar"
                                                                    id="btn-agregarEstudioImg">
                                                                <i class="bi bi-person-badge"></i> Agregar
                                                            </button>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="col-6">
                                                    <ul class="list-group" id="list-estudios-ultrasonido">
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="accordion-item">
                                    <h2 class="accordion-header" id="headingFour">
                                        <button class="accordion-button collapsed" type="button"
                                                data-bs-toggle="collapse"
                                                data-bs-target="#collapseFour" aria-expanded="false"
                                                aria-controls="collapseFour">
                                            Otros Estudios
                                        </button>
                                    </h2>
                                    <div id="collapseFour" class="accordion-collapse collapse"
                                         aria-labelledby="headingFour">
                                        <div class="accordion-body">
                                            <div class="row">
                                                <div class="col-6">
                                                    <div class="row">
                                                        <div class="col-12">
                                                            <select class="" id="select-otros">
                                                            </select>
                                                        </div>
                                                        <div class="col-12">
                                                            <button type="button" class="btn btn-confirmar"
                                                                    id="btn-agregarEstudioOtros">
                                                                <i class="bi bi-person-badge"></i> Agregar
                                                            </button>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="col-6">
                                                    <ul class="list-group" id="list-estudios-otros">
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>


                        <div class="col-12 col-md-4 FirstPage-aceptar">

                            <div class="my-2">
                                <label for="paquete" class="form-label">Selecciona un paquete</label>
                                <select class="" id="select-paquetes">
                                </select>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" value="" checked
                                           id="checkPaqueteAceptar">
                                    <label class="form-check-label" for="checkPaqueteAceptar">
                                        Sin paquete
                                    </label>
                                </div>
                            </div>

                            <div class="my-3">
                                <div class="d-flex justify-content-between align-items-center gap-2">
                                    <div>
                                        <label for="input-cotizacion" class="form-label">Importar estudio desde
                                            cotización</label>
                                        <input type="number" class="form-control input-form input-cotizacion"
                                               id="input-cotizacion"
                                               placeholder="Ingrese el folio de cotización">
                                    </div>

                                    <button id="btnCotizacion" class="btn btn-confirmar mt-4" style="display: none;">
                                        Cargar
                                    </button>
                                </div>

                                <div class="form-check mt-2">
                                    <input class="form-check-input" type="checkbox" value="" checked
                                           id="checkCotizacionAceptar">
                                    <label class="form-check-label" for="checkCotizacionAceptar">
                                        Sin cotización
                                    </label>
                                </div>
                            </div>

                            <div class="row my-2">
                                <div class="col-12">
                                    <h5>Total a pagar</h5>
                                </div>

                                <div class="col-11 text-end pr-1 info-detalle">
                                    <p>Total del paquete: <span style="color: #0c0c0c" id="aceptar-totalPaqueteCargado">$0.00</span></p>
                                </div>

                                <div class="col-11 text-end pr-1 info-detalle">
                                    <p>Total de estudios individuales: <span style="color: #0c0c0c" id="aceptar-totalCargado">$0.00</span></p>
                                </div>

                            </div>

                            <!-- COMO NOS CONOCISTE? -->
                            <div class="row my-2" id="comoNosConocisteDiv">

                            </div>
                        </div>

                        <div class="col-12 SecondPage-aceptar">
                            <!-- <h4 class="mt-2">Buscar un paquete</h4> -->
                            <div class="col-12 p-3">
                                <h4>Cargar información</h4>
                                <p>Ingrese informacion adicional si es necesario</p>
                                <div class="row px-4">
                                    <div class="col-12 col-md-6">
                                        <div class="rounded p-3 shadow my-2">
                                            <div class="mt-3">
                                                <label for="paquete" class="form-label">Segmento del paciente</label>
                                                <select class="select2-selection__rendered" id="select-segmento-aceptar"
                                                        name="segmento_id">
                                                </select>
                                            </div>

                                            <div class="mt-3">
                                                <label for="est_alergias"
                                                       class="form-label fw-bold text-danger text-decoration-underline">Alergias:
                                                </label>
                                                <input type="text" name="est_alergias" value=""
                                                       class="form-control input-form fw-bold text-danger text-decoration-underline"
                                                       required=""
                                                       id="alergias-aceptar-paciente">
                                            </div>

                                            <div class="mt-3">
                                    <textarea rows="4" cols="90" class="input-form" placeholder="Observaciones"
                                              id="Observaciones-aceptar"></textarea>
                                            </div>
                                        </div>

                                    </div>


                                    <div class="col-12 col-md-6">
                                        <div class="rounded p-3 shadow my-2">
                                            <div class="mt-3">
                                                <label for="est_diagnostico" class="form-label">Diagnóstico: </label>
                                                <input type="text" name="est_diagnostico" value=""
                                                       class="form-control input-form" required=""
                                                       id="diagnostico-aceptar-paciente">
                                            </div>

                                            <div class="mt-3">
                                                <label for="est_vendedor" class="form-label">Vendedor: </label>
                                                <!-- <input type="text" name="est_diagnostico" value="" class="form-control input-form" required=""
                                                                                  id="diagnostico-aceptar-paciente"> -->
                                                <select class="form-control input-form" id="select-vendedor"
                                                        name="vendedor"
                                                        placeholder="Seleccione un vendedor">

                                                </select>
                                            </div>

                                            <div class="mt-3">
                                                <label for="medico_tratante" class="form-label">Médico
                                                    tratante: </label>
                                                <select id="select-recepcion-medicos-tratantes"
                                                        class="form-control input-form"
                                                        name="medico_tratante_id">
                                                </select>

                                                <div class="form-check mt-1">
                                                    <input class="form-check-input" type="checkbox"
                                                           id="checkBox-NewMedico">
                                                    <label class="form-check-label" for="checkBox-NewMedico">
                                                        Agregar nuevo
                                                    </label>
                                                </div>
                                                <div class="collapse" id="CollapseNuevoMedico">
                                                    <div class="shadow rounded p-3">

                                                        <input type="text" name="medico_tratante"
                                                               placeholder="Nombre del médico tratante"
                                                               class="input-new-medico form-control input-form"
                                                               id="medico-aceptar-paciente"
                                                               autocomplete="off">

                                                        <div id="suggestionsBox" class="d-none">
                                                            <span>Médicos Existentes:</span>
                                                            <div id="suggestionsList"></div>
                                                        </div>

                                                        <!-- <input type="text" name="medico_correo" placeholder="Correo del médico tratante"
                                                          autocomplete="off" class="input-new-medico form-control input-form"
                                                          id="medico-correo-aceptar"> -->

                                                        <!-- <div class="col-12"> -->
                                                        <!-- <label>Correo:</label> -->
                                                        <input type="email"
                                                               class="form-control input-form email-medicoTratante"
                                                               placeholder="Correo del médico tratante"
                                                               data-collapse-name="collapseConfirmacion_edit"
                                                               data-pair-id="input_actualizar_edit" data-email-order="1"
                                                               name="medico_correo"
                                                               id="email-medicoTratante-a">
                                                        <!-- </div> -->

                                                        <div class="collapse email-collapse"
                                                             id="collapseConfirmacion_edit">
                                                            <!-- <div class="col-12 mb-3"> -->
                                                            <!-- <label>Confirma el correo:</label> -->
                                                            <input type="email"
                                                                   class="form-control input-form email-medicoTratante"
                                                                   placeholder="Confirma el correo"
                                                                   data-pair-id="input_actualizar_edit"
                                                                   data-email-order="2">
                                                            <small class="error-message"
                                                                   style="color: red; display: none;">Los correos no
                                                                coinciden</small>
                                                            <!-- </div> -->
                                                        </div>


                                                        <input type="number" name="medico_telefono"
                                                               placeholder="Teléfono del médico tratante"
                                                               autocomplete="off"
                                                               class="input-new-medico form-control input-form"
                                                               id="medico-telefono-aceptar">

                                                        <input type="text" name="medico_especialidad"
                                                               placeholder="Especialidad del médico tratante"
                                                               autocomplete="off"
                                                               class="input-new-medico form-control input-form"
                                                               id="medico-especialidad-aceptar">
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer" style="zoom:90%">
                <button type="button" class="btn btn-cancelar" data-bs-dismiss="modal">
                    <i class="bi bi-x-square"></i> Cerrar
                </button>

                <button type="button" class="btn btn-cancelar SecondPage-aceptar pagination-aceptar"
                        page="SecondPage-aceptar"
                        nextPage="FirstPage-aceptar">
                    <i class="bi bi-arrow-left-circle"></i> Atras
                </button>

                <button type="button" class="btn btn-cancelar FirstPage-aceptar pagination-aceptar"
                        page="FirstPage-aceptar"
                        nextPage="SecondPage-aceptar">
                    <i class="bi bi-arrow-right-circle"></i> Siguiente
                </button>

                <button type="submit" form="formAceptarPacienteRecepcion" data-pair-id="input_actualizar_edit"
                        class="btn btn-confirmar SecondPage-aceptar btn_confirmar_correo" id="btn-confirmar-paciente">
                    <i class="bi bi-check2-square"></i> Aceptar paciente
                </button>
            </div>
        </div>
    </div>
</div>

<style>
    .chip {
        display: inline-block;
        padding: 4px 8px;
        border-radius: 16px;
        margin-right: 5px;
        margin-bottom: 5px;
        /* background-color: #f1f1f1; */
        font-size: 13px;
    }

    .chip:hover {
        /* background-color: #ddd; */
    }
</style>


<script>
    $('.email-medicoTratante').on('input', function (event) {
        event.preventDefault();
        // Obtiene el ID del collapse asociado desde el atributo data-collapse-name
        var collapseId = $(this).data('collapse-name');
        var collapseElement = $('#' + collapseId);
        var inputConfirmacion = collapseElement.find('input[type=email]');

        if ($(this).val() !== '') {
            collapseElement.collapse('show');
            inputConfirmacion.prop('required', true);
        } else {
            collapseElement.collapse('hide');
            inputConfirmacion.prop('required', false);
        }


        // Comparar los correos en tiempo real y mostrar mensaje de error si no coinciden
        var pairId = $(this).data('pair-id');
        var emailOrder = $(this).data('email-order');

        if (emailOrder === 1) {
            var collapseId = $(this).data('collapse-name');
            $('#' + collapseId).collapse('show');
        }

        var primaryEmail = $('[data-pair-id="' + pairId + '"][data-email-order="1"]').val();
        var confirmationEmail = $('[data-pair-id="' + pairId + '"][data-email-order="2"]').val();
        var errorMessage = $('[data-pair-id="' + pairId + '"][data-email-order="2"]').siblings('.error-message');
        var confirmButton = $('.btn_confirmar_correo[data-pair-id="' + pairId + '"]');


        if ((primaryEmail !== '' && confirmationEmail !== '') && (primaryEmail == confirmationEmail)) {
            errorMessage.hide();
            confirmButton.prop('disabled', false);
        } else {
            errorMessage.show();
            confirmButton.prop('disabled', true);
        }
    });
</script>