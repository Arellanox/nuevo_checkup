<!-- Modal para nueva requisición -->
<div class="modal fade" id="registrarVacanteModal" tabindex="-1" aria-labelledby="registrarVacanteModalLabel" aria-hidden="true" data-bs-backdrop="true" data-bs-keyboard="true">
    <div class="modal-dialog modal-xl">
        <div class="modal-content shadow-lg border-0">
            <div class="modal-header bg-gradient-custom text-white border-0">
                <h5 class="modal-title fw-bold" id="registrarVacanteModalLabel">
                    <i class="bi bi-file-earmark-text me-2"></i>Nueva Requisición de Personal
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body bg-light" style="max-height: 70vh; overflow-y: auto;">
                <!-- Contenido del formulario -->
                <form id="formRegistrarVacante" name="formRegistrarVacante">
                    
                    <!-- INFORMACIÓN GENERAL -->
                    <div class="card mb-4 border-0 shadow-sm">
                        <div class="card-header bg-radient-custom border-0" style="color: #004E59;">
                            <h6 class="mb-0 fw-bold"><i class="bi bi-info-circle me-2"></i>Información General</h6>
                        </div>
                        <div class="card-body">
                            <!-- Campos ocultos para solicitante y fecha -->
                            <input type="hidden" id="solicitante" name="solicitante">
                            <input type="hidden" id="usuario_id" name="usuario_id">
                            <input type="hidden" id="fecha_solicitud" name="fecha_solicitud">
                            
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="departamento" class="form-label">Departamento</label>
                                        <div class="input-group">
                                            <select class="form-select rounded-3 border-2" id="departamento" name="departamento" required>
                                                <option value="">Seleccionar departamento...</option>
                                            </select>
                                            <button class="btn btn-outline-primary rounded-3" type="button" id="btnCatalogoDepartamentos" title="Gestionar Departamentos">
                                                <i class="bi bi-plus"></i>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="motivo_requisicion" class="form-label">Motivo de la Requisición</label>
                                        <select class="form-select rounded-3 border-2" id="motivo_requisicion" name="motivo_requisicion" required>
                                            <option value="">Seleccionar motivo...</option>
                                            <option value="nueva_posicion">Nueva posición</option>
                                            <option value="reemplazo_renuncia">Reemplazo por renuncia</option>
                                            <option value="reemplazo_despido">Reemplazo por despido</option>
                                            <option value="reemplazo_incapacidad">Reemplazo por incapacidad</option>
                                            <option value="crecimiento_area">Crecimiento del área</option>
                                            <option value="proyecto_temporal">Proyecto temporal</option>
                                            <option value="carga_trabajo">Incremento de carga de trabajo</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- DETALLES DEL PUESTO -->
                    <div class="card mb-4 border-0 shadow-sm">
                        <div class="card-header bg-radient-custom border-0" style="color: #004E59;">
                            <h6 class="mb-0 fw-bold"><i class="bi bi-briefcase me-2"></i>Detalles del Puesto</h6>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="mb-3" id="puestoContainer">
                                        <label for="puesto" class="form-label">Cargo o Título Solicitado</label>
                                        <div class="input-group">                                            
                                            <select class="form-select rounded-3 border-2" id="puesto" name="puesto">
                                                <option value="">Seleccionar puesto...</option>
                                            </select>
                                            <button class="btn btn-outline-primary rounded-3" type="button" id="btnCatalogoPuestos" title="Gestionar Puestos">
                                                <i class="bi bi-plus"></i>
                                             </button>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="tipo_contrato" class="form-label">Tipo de Contrato</label>
                                        <select class="form-select rounded-3 border-2" id="tipo_contrato" name="tipo_contrato" required>
                                            <option value="">Seleccionar tipo...</option>
                                            <option value="permanente">Permanente</option>
                                            <option value="temporal">Temporal</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="tipo_jornada" class="form-label">Tipo de Jornada</label>
                                        <select class="form-select rounded-3 border-2" id="tipo_jornada" name="tipo_jornada" required>
                                            <option value="">Seleccionar jornada...</option>
                                            <option value="tiempo_completo">Tiempo completo</option>
                                            <option value="medio_tiempo">Medio tiempo</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- PERFIL DESEADO -->
                    <div class="card mb-4 border-0 shadow-sm">
                        <div class="card-header bg-radient-custom border-0" style="color: #004E59;">
                            <h6 class="mb-0 fw-bold"><i class="bi bi-person-badge me-2"></i>Perfil Deseado</h6>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="escolaridad_minima" class="form-label">Escolaridad Mínima Requerida</label>
                                        <select class="form-select rounded-3 border-2" id="escolaridad_minima" name="escolaridad_minima" required>
                                            <option value="">Seleccionar escolaridad...</option>
                                            <option value="primaria">Primaria</option>
                                            <option value="secundaria">Secundaria</option>
                                            <option value="preparatoria">Preparatoria/Bachillerato</option>
                                            <option value="tecnico">Técnico</option>
                                            <option value="licenciatura">Licenciatura</option>
                                            <option value="maestria">Maestría</option>
                                            <option value="doctorado">Doctorado</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="experiencia_anos" class="form-label">Experiencia Laboral (años)</label>
                                        <select class="form-select rounded-3 border-2" id="experiencia_anos" name="experiencia_anos" required>
                                            <option value="">Seleccionar experiencia...</option>
                                            <option value="sin_experiencia">Sin experiencia</option>
                                            <option value="1">1 año</option>
                                            <option value="2">2 años</option>
                                            <option value="3">3 años</option>
                                            <option value="4">4 años</option>
                                            <option value="5">5 años</option>
                                            <option value="5+">Más de 5 años</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            <div class="mb-3">
                                <label for="experiencia_area" class="form-label">Área de Experiencia</label>
                                <input type="text" class="form-control rounded-3 border-2" id="experiencia_area" name="experiencia_area" placeholder="Ej: Ventas, Marketing, Administración...">
                            </div>
                            <div class="mb-3">
                                <label for="conocimientos_tecnicos" class="form-label">Conocimientos Específicos o Técnicos</label>
                                <textarea class="form-control rounded-3 border-2" id="conocimientos_tecnicos" name="conocimientos_tecnicos" rows="3" placeholder="Ej: Office, sistemas específicos, certificaciones..."></textarea>
                            </div>
                            <div class="mb-3">
                                <label for="habilidades_blandas" class="form-label">Habilidades Blandas Esperadas</label>
                                <textarea class="form-control rounded-3 border-2" id="habilidades_blandas" name="habilidades_blandas" rows="3" placeholder="Ej: Trabajo en equipo, comunicación efectiva, liderazgo..."></textarea>
                            </div>
                            <div class="mb-3">
                                <label for="idiomas" class="form-label">Idiomas Requeridos</label>
                                <input type="text" class="form-control rounded-3 border-2" id="idiomas" name="idiomas" placeholder="Ej: Inglés intermedio, Francés básico...">
                            </div>
                        </div>
                    </div>

                    <!-- CONDICIONES LABORALES -->
                    <div class="card mb-4 border-0 shadow-sm">
                        <div class="card-header bg-radient-custom border-0" style="color: #004E59;">
                            <h6 class="mb-0 fw-bold"><i class="bi bi-clock me-2"></i>Condiciones Laborales</h6>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="horario_trabajo" class="form-label">Horario de Trabajo</label>
                                        <input type="text" class="form-control rounded-3 border-2" id="horario_trabajo" name="horario_trabajo" placeholder="Ej: 8:00 AM - 5:00 PM, L-V" required>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="rango_salarial" class="form-label">Rango Salarial (Opcional)</label>
                                        <input type="text" class="form-control rounded-3 border-2" id="rango_salarial" name="rango_salarial" placeholder="Ej: $15,000 - $25,000">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- COMENTARIOS ADICIONALES -->
                    <div class="card mb-4 border-0 shadow-sm">
                        <div class="card-header bg-radient-custom border-0" style="color: #004E59;">
                            <h6 class="mb-0 fw-bold"><i class="bi bi-chat-text me-2"></i>Información Adicional</h6>
                        </div>
                        <div class="card-body">
                            <div class="mb-3">
                                <label for="comentarios_adicionales" class="form-label">Comentarios Adicionales</label>
                                <textarea class="form-control rounded-3 border-2" id="comentarios_adicionales" name="comentarios_adicionales" rows="4" placeholder="Cualquier detalle extra que ayude a entender la necesidad de la vacante o el contexto del área..."></textarea>
                            </div>
                        </div>
                    </div>

                </form>
            </div>
            <div class="modal-footer bg-light border-0">
                <button type="button" class="btn btn-outline-secondary rounded-pill px-4" data-bs-dismiss="modal">
                    <i class="bi bi-x-circle me-2"></i>Cancelar
                </button>
                <button type="submit" form="formRegistrarVacante" class="btn btn-gradient-custom rounded-pill px-4 fw-bold">
                    <i class="bi bi-check-circle me-2"></i>Guardar Requisición
                </button>
            </div>
        </div>
    </div>
</div>

<script>
// Variable para controlar si se debe reabrir el modal de requisición
let debeReabrirModalRequisicion = false;

// FUNCIÓN para el botón de catálogo de departamentos
$(document).on('click', '#btnCatalogoDepartamentos', function(e) {
    e.preventDefault();
    e.stopPropagation();
    
    debeReabrirModalRequisicion = true;
    console.log("Botón catálogo departamentos clickeado, bandera activada:", debeReabrirModalRequisicion);
    
    // Cerrar el modal de requisición
    $("#registrarVacanteModal").modal("hide");
    
    // Esperar a que se cierre completamente y luego abrir el modal de catálogos
    $("#registrarVacanteModal").on('hidden.bs.modal', function(e) {
        if (debeReabrirModalRequisicion) {
            // Remover el event listener para evitar múltiples ejecuciones
            $(this).off('hidden.bs.modal');
            
            setTimeout(function() {
                $("#registrarCatalogoModal").modal("show");
                
                // Cuando se abra el modal de catálogos, cambiar a la pestaña de departamentos
                $("#registrarCatalogoModal").on('shown.bs.modal', function() {
                    $(this).off('shown.bs.modal'); // Remover listener
                    $("#departamentos-tab").tab("show");
                    console.log("Modal de catálogos abierto y pestaña de departamentos activada");
                    
                    // Después de activar la pestaña, abrir el modal de registro
                    setTimeout(function() {
                        $("#registrarDepartamentoModal").modal("show");
                        console.log("Modal de registro de departamento abierto automáticamente");
                    }, 500); // Esperar un poco más para que se establezca la pestaña
                });
            }, 300);
        }
    });
});


$(document).on('click', '#btnCatalogoPuestos', function(e) {
    e.preventDefault();
    e.stopPropagation();
    
    debeReabrirModalRequisicion = true;
    console.log("Botón catálogo puestos clickeado, bandera activada:", debeReabrirModalRequisicion);
    
    // Cerrar el modal de requisición
    $("#registrarVacanteModal").modal("hide");
    
    // Esperar a que se cierre completamente y luego abrir el modal de catálogos
    $("#registrarVacanteModal").on('hidden.bs.modal', function(e) {
        if (debeReabrirModalRequisicion) {
            // Remover el event listener para evitar múltiples ejecuciones
            $(this).off('hidden.bs.modal');
            
            setTimeout(function() {
                $("#registrarCatalogoModal").modal("show");
                
                // Cuando se abra el modal de catálogos, cambiar a la pestaña de departamentos
                $("#registrarCatalogoModal").on('shown.bs.modal', function() {
                    $(this).off('shown.bs.modal'); // Remover listener
                    $("#puestos-tab").tab("show");
                    console.log("Modal de catálogos abierto y pestaña de departamentos activada");
                    
                    // Después de activar la pestaña, abrir el modal de registro
                    setTimeout(function() {
                        $("#registrarPuestoModal").modal("show");
                        console.log("Modal de registro de puestos abierto automáticamente");
                    }, 500); // Esperar un poco más para que se establezca la pestaña
                });
            }, 300);
        }
    });
});

// Event listener para cuando se cierre el modal de catálogos
$("#registrarCatalogoModal").on('hidden.bs.modal', function() {
    if (debeReabrirModalRequisicion) {
        debeReabrirModalRequisicion = false;
        console.log("Cerrando modal de catálogos, reabriendo modal de requisición");
        
        setTimeout(function() {
            // Recargar los puestos cuando regrese al modal
            if (typeof cargarPuestosVacanteSelect === 'function') {
            cargarPuestosVacanteSelect();
            }
            $("#registrarVacanteModal").modal("show");
            
            // Recargar los departamentos cuando regrese al modal
            if (typeof cargarDepartamentosVacanteSelect === 'function') {
                cargarDepartamentosVacanteSelect();
            }
        }, 300);
    }
});

// Event listener para cuando se cierre el modal de registro de departamento
$("#registrarDepartamentoModal").on('hidden.bs.modal', function() {
    if (debeReabrirModalRequisicion) {
        console.log("Modal de departamento cerrado, regresando a catálogos");
        // No hacer nada aquí, dejar que el modal de catálogos maneje el flujo
        // El modal de catálogos seguirá abierto en segundo plano
    }
});
</script>

<style>
/* Estilos para el modal de registrar vacante - coincidentes con recursos_humanos.html */
body {
    background-color: #f8f9fa;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
}

.modal-content {
    border-radius: 15px;
    overflow: hidden;
}

.bg-gradient-primary {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
}

.bg-gradient-custom {
    background: linear-gradient(135deg, #004E59 0%, #007d8f 100%);
}

.bg-gradient-success {
    background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
}

.bg-gradient-info {
    background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
}

.bg-gradient-warning {
    background: linear-gradient(135deg, #e9d643 0%, #fee140 100%);
}

.bg-gradient-secondary {
    background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
}

.bg-gradient-dark {
    background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
}

.btn-gradient-primary {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    border: none;
    color: white;
    transition: all 0.3s ease;
}

.btn-gradient-custom {
    background: linear-gradient(135deg, #004E59 0%, #007d8f 100%);
    border: none;
    color: white;
    transition: all 0.3s ease;
}

.btn-gradient-primary:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 15px rgba(102, 126, 234, 0.3);
    color: white;
}

.card {
    border: none;
    transition: all 0.3s ease;
}

.card:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 15px rgba(0, 0, 0, 0.1);
}

.form-control, .form-select {
    transition: all 0.3s ease;
}

.form-control:focus, .form-select:focus {
    border-color: #667eea;
    box-shadow: 0 0 0 0.2rem rgba(102, 126, 234, 0.25);
    transform: translateY(-1px);
}

.btn-outline-primary {
    border-color: #667eea;
    color: #667eea;
    transition: all 0.3s ease;
}

.btn-outline-primary:hover {
    background-color: #667eea;
    border-color: #667eea;
    transform: translateY(-1px);
    box-shadow: 0 4px 8px rgba(102, 126, 234, 0.3);
}

.btn-outline-secondary {
    transition: all 0.3s ease;
}

.btn-outline-secondary:hover {
    transform: translateY(-1px);
    box-shadow: 0 4px 8px rgba(108, 117, 125, 0.3);
}

.rounded-pill {
    border-radius: 50rem !important;
}

.shadow-lg {
    box-shadow: 0 1rem 3rem rgba(0, 0, 0, 0.175) !important;
}

.fw-bold {
    font-weight: 700 !important;
}

@keyframes fadeIn {
    from { 
        opacity: 0; 
        transform: translateY(10px); 
    }
    to { 
        opacity: 1; 
        transform: translateY(0); 
    }
}

.modal.fade .modal-dialog {
    transition: transform 0.3s ease-out;
}

.modal.show .modal-dialog {
    animation: fadeIn 0.3s ease-in;
}
</style>