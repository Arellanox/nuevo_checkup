
<div class="container-fluid p-4" id="divPadreCimmo">

    <!-- ACCORDION: NUEVO PACIENTE -->
    <div class="accordion mb-4" id="accordionPaciente">
        <div class="accordion-item card-custom" id="acordion-paciente">
            <h2 class="accordion-header">
                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#nuevoPaciente">
                    âž• Agregar nuevo paciente
                </button>
            </h2>

            <div id="nuevoPaciente" class="accordion-collapse collapse">
                <div class="accordion-body">
                    <form id="formPaciente" class="row g-3">

                        <!-- ID -->
                        <div class="col-md-2">
                            <label class="form-label label-title">ID Paciente</label>
                            <input type="text" id="id_paciente" name="id_paciente" class="form-control" placeholder="Ej. 12345" required>
                            <small class="text-muted">Identificador Ãºnico del paciente</small>
                        </div>

                        <!-- Nombre -->
                        <div class="col-md-4">
                            <label class="form-label label-title">Nombre</label>
                            <input type="text" id="paciente" name="paciente" class="form-control" placeholder="Nombre completo" required>
                            <small class="text-muted">Escribe el nombre tal como aparece en la identificaciÃ³n</small>
                        </div>

                        <!-- Sexo -->
                        <div class="col-md-2">
                            <label class="form-label label-title">Sexo</label>
                            <select id="sexo" name="sexo" class="form-select">
                                <option value="" disabled selected>Selecciona...</option>
                                <option value="1">Masculino</option>
                                <option value="2">Femenino</option>
                            </select>
                            <small class="text-muted">Selecciona el sexo biolÃ³gico</small>
                        </div>

                        <!-- Fecha de nacimiento -->
                        <div class="col-md-2">
                            <label class="form-label label-title">Fecha de nacimiento</label>
                            <input type="date"id="nacimiento" name="nacimiento" class="form-control" id="fechaNac">
                            <small class="text-muted">Selecciona la fecha de nacimiento</small>
                        </div>

                        <!-- Edad (no editable) -->
                        <div class="col-md-2">
                            <label class="form-label label-title">Edad</label>
                            <input type="text" id="edad" name="edad" class="form-control" id="edad" readonly>
                            <small class="text-muted">Se calcula automÃ¡ticamente</small>
                        </div>

                        <div class="col-12 text-end">
                            <button id="btnGuardarPaciente" class="btn btn-primary px-4">Guardar</button>
                        </div>

                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- SECCIÃ“N INFERIOR -->
    <div class="row">

        <!-- PACIENTES -->
        <div class="col-md-4">
            <div class="card card-custom p-3">

                <h5 class="mb-3">ðŸ“‹ Lista de Pacientes</h5>

                <!-- FILTRO POR FECHA -->
                <label class="form-label label-title">Filtrar por fecha:</label>
                 <!-- FECHA -->
                <div class="input-group">
                     <input type="date" class="form-control" id="filtroFecha">

                    <!-- BOTÃ“N ZIP -->
                    <button class="btn btn-danger" id="btnDescargarZip" title="Descargar ZIP">
                        ðŸ“¦ Descargar PDF's
                    </button>
                </div>
               
                <small class="text-muted">Selecciona la fecha de registro</small>

                <table id="tablaPacientes" class="table table-striped" style="width:100%">
                    <!-- <thead class="table-primary">
                        <tr>
                            <th>ID</th>
                            <th>Nombre</th>
                        </tr>
                    </thead>
                    <tbody>
                    </tbody> -->
                </table>

            </div>
        </div>

        <!-- RESULTADOS -->
        <div class="col-md-8" >
            <div class="card card-custom p-4" id="panelResultados">

              <h4 class="mb-1 d-flex align-items-center gap-3">

                    ðŸ§ª Resultados del Paciente

                    <span class="ms-3">

                        <!-- ICONO PDF ROJO -->
                        <span id="verPDF" style="display: none;">
                            <a href="#" target="_blank" id="linkPDF" style="font-size: 26px; text-decoration:none; color: red;">
                                <i class="fa fa-file-pdf"></i> Reporte
                            </a>
                        </span>

                        <!-- BOTÃ“N CONFIRMAR -->
                        <span id="verBtnConfirmar" style="display: none;">
                            <button class="btn btn-primary px-4" id="btnConfirmar">Confirmar</button>
                        </span>

                    </span>

                </h4>
    
                <h2 class="text-primary fw-bold mt-2">
                    <span id="spanNombrePaciente"></span>
                    <span id="spanIdPaciente" class="ms-3 text-dark"></span>
                </h2>
                <p class="text-muted">Selecciona un paciente de la lista para cargar resultados</p>
                <hr>

                <h5 id="pacienteSeleccionado" class="text-primary"></h5>

                <form class="row g-3 mt-2" id="formResultados" name="formResultados">

                    <div class="col-md-4">
                        <label class="form-label label-title">VIH 1 y 2</label>
                        <input type="text" id="vih" name="vih" class="form-control" placeholder="Ej. 1.0">
                        <!-- <select class="form-select">
                            <option value="" disabled selected>Selecciona...</option>
                            <option>Reactivo</option>
                            <option>No Reactivo</option>
                        </select> -->
                    </div>

                    <div class="col-md-4">
                        <label class="form-label label-title">VHB</label>
                        <input type="text" id="vhb" name="vhb" class="form-control" placeholder="Ej. 0.2">
                        <!-- <select class="form-select">
                            <option value="" disabled selected>Selecciona...</option>
                            <option>Reactivo</option>
                            <option>No Reactivo</option>
                        </select> -->
                    </div>

                    <div class="col-md-4">
                        <label class="form-label label-title">VHC</label>
                        <input type="text" id="vhc" name="vhc" class="form-control" placeholder="Ej. 0.5">
                        <!-- <select class="form-select">
                            <option value="" disabled selected>Selecciona...</option>
                            <option>Reactivo</option>
                            <option>No Reactivo</option>
                        </select> -->
                    </div>

                    <div class="col-12">
                        <label class="form-label label-title">Observaciones</label>
                        <textarea class="form-control" id="observaciones" name="observaciones" rows="3" placeholder="Escribe cualquier observaciÃ³n relevante..."></textarea>
                    </div>

                    <div class="col-12 text-end">
                        <input type="submit" class="btn btn-success px-4" value="Guardar Resultados">
                    </div>
                </form>

            </div>
        </div>

    </div>
</div>

<!-- JS -->
<script>

    // Calcular edad automÃ¡ticamente
    document.getElementById("nacimiento").addEventListener("change", function() {
        const fecha = new Date(this.value);
        const hoy = new Date();
        let edad = hoy.getFullYear() - fecha.getFullYear();
        const mes = hoy.getMonth() - fecha.getMonth();

        if (mes < 0 || (mes === 0 && hoy.getDate() < fecha.getDate())) {
            edad--;
        }

        document.getElementById("edad").value = edad > 0 ? edad + " aÃ±os" : "";
    });
</script>

<style>
    .border-pulse {
        box-shadow: 0 0 10px #0d6efd;
        transition: box-shadow .7s ease;
    }

    .highlight {
        background-color: #fff3cd !important;
        transition: background-color 1s ease;
    }
</style>
