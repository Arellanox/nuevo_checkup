<div class="modal fade" id="registrarRequisicionModal" tabindex="-1" data-bs-backdrop="static" data-bs-focus="false"
    data-bs-keyboard="false" role="dialog" aria-labelledby="modalTitleId" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered modal-dialog-scrollable" role="document">

        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="liberarDiaTitle">Registrar <strong>Nueva requisición</strong></h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body container-fluid">
                <div class="container-fluid">
                    <div class="row">
                        <form id="registrarRequisicionForm" name="registrarRequisicionForm">
                            <div class="col-12">
                                <div class="text-start">
                                <div class="shadow-sm rounded p-3 card-body">
                                <h5 class="text-dark">Nueva Requisición</h5>

                <!-- Departamento que solicita -->
                <div class="card mb-4">
                    <div class="card-body">
                        <h6 class="card-title">Departamento que solicita</h6>
                        <div class="mb-3">
                            <label for="departamento" class="form-label">Departamento</label>
                            <select class="form-select input-form" id="departamento" name="departamento" required>
                                <option value="">Seleccione un departamento</option>
                                <option value="6">Laboratorio clínico</option>
                                <option value="12">Laboratorio biomolecular</option>
                                <option value="19">Checkups</option>
                                <option value="23">Otro</option>
                            </select>
                            <div class="invalid-feedback">Este campo es obligatorio.</div>
                        </div>
                    </div>
                </div>

                <!-- Artículo -->
                <div class="card mb-4">
                    <div class="card-body">
                        <h6 class="card-title">Artículo</h6>
                        <div class="row">
                            <!-- Tipo de artículo -->
                            <div class="col-6">
                                <div class="mb-3">
                                    <label for="tipo_articulo" class="form-label">Tipo de Artículo</label>
                                    <select class="form-select input-form" id="tipo_articulo" name="tipo_articulo" required>
                                        <option value="">Seleccione un tipo</option>
                                        <option value="Reactivo">Reactivo</option>
                                        <option value="Insumo">Insumo</option>
                                        <option value="Medicamento">Medicamento</option>
                                    </select>
                                    <div class="invalid-feedback">Este campo es obligatorio.</div>
                                </div>
                            </div>
                            <!-- Nombre comercial con búsqueda -->
                            <div class="col-6">
                                <div class="mb-3">
                                    <label for="nombre_comercial" class="form-label">Nombre Comercial</label>
                                    <!-- Puedes reemplazar esto por Select2 para mejor UX -->
                                    <input class="form-control input-form" list="nombresComerciales" step="any" id="nombre_comercial" name="nombre_comercial" required placeholder="Escriba para buscar...">
                                    <datalist id="nombresComerciales">
                                        <!-- Estos valores deben llenarse dinámicamente según el tipo de artículo -->
                                        <option value="Reactivo A">
                                        <option value="Reactivo B">
                                        <option value="Insumo X">
                                        <option value="Medicamento Y">
                                    </datalist>
                                    <div class="invalid-feedback">Este campo es obligatorio.</div>
                                </div>
                            </div>
                            <!-- Cantidad -->
                            <div class="col-6">
                                <div class="mb-3">
                                    <label for="cantidad" class="form-label">Cantidad</label>
                                    <input type="number" step="any" class="form-control input-form" id="cantidad" name="cantidad" min="1" required>
                                    <div class="invalid-feedback">Este campo es obligatorio.</div>
                                </div>
                            </div>
                            <!-- Unidad -->
                            <div class="col-6">
                                <div class="mb-3">
                                    <label for="unidad" class="form-label">Unidad</label>
                                    <select class="form-select input-form" id="unidad" name="unidad" required>
                                        <option value="">Seleccione una unidad</option>
                                        <option value="Por pieza (unidad)">Por pieza (unidad)</option>
                                        <option value="Por caja">Por caja</option>
                                        <option value="Por blíster (tira)">Por blíster (tira)</option>
                                        <option value="Por frasco / botella">Por frasco / botella</option>                                                            <option value="Por ampolla o vial">Por ampolla o vial</option>
                                        <option value="Por gramo / mililitro">Por gramo / mililitro</option>
                                        <option value="Por kit o presentación combinada">Por kit o presentación combinada</option>
                                    </select>
                                    <div class="invalid-feedback">Este campo es obligatorio.</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Fecha requerida y prioridad -->
                <div class="card mb-4">
                    <div class="card-body">
                        <h6 class="card-title">Detalles de la Requisición</h6>
                        <div class="row">
                            <!-- Fecha requerida -->
                            <div class="col-6">
                                <div class="mb-3">
                                    <label for="fecha_requerida" class="form-label">Fecha Requerida</label>
                                    <input type="date" class="form-control input-form" id="fecha_requerida" name="fecha_requerida" required>
                                    <div class="invalid-feedback">Este campo es obligatorio.</div>
                                </div>
                            </div>
                            <!-- Prioridad -->
                            <div class="col-6">
                                <div class="mb-3">
                                    <label for="prioridad" class="form-label">Prioridad</label>
                                    <select class="form-select input-form" id="prioridad" name="prioridad" required>
                                        <option value="">Seleccione prioridad</option>
                                        <option value="Baja">Baja</option>
                                        <option value="Normal">Normal</option>
                                        <option value="Urgente">Urgente</option>
                                    </select>
                                    <div class="invalid-feedback">Este campo es obligatorio.</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Estatus -->
                <div class="card mb-4">
                    <div class="card-body">
                        <h6 class="card-title">Estatus</h6>
                        <div class="mb-3">
                            <label for="estatus" class="form-label">Estatus</label>
                            <select class="form-select input-form" id="estatus" name="estatus" required>
                                <option value="">Seleccione estatus</option>
                                <option value="Pendiente">Pendiente</option>
                                <option value="En proceso">En proceso</option>
                                <option value="Finalizado">Finalizado</option>
                            </select>
                            <div class="invalid-feedback">Este campo es obligatorio.</div>
                        </div>
                    </div>
                </div>

                        </div>
                    </div>
                </div>
            </form>
        </div>
    </div>
 </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-cancelar" data-bs-dismiss="modal"><i
                        class="bi bi-arrow-left-short"></i>
                    Cancelar</button>
                </button>

                <button type="submit" class="btn btn-confirmar"
                    form="registrarRequisicionForm">
                    <i class="bi bi-floppy-fill"></i> Guardar
                </button>
            </div>
        </div>

    </div>
</div>



<script>
// Validación en Tiempo Real
$('#registrarRequisicionForm input, #registrarRequisicionForm select').on('input change', function() {
    if ($(this).val() === '') {
        $(this).addClass('is-invalid');
    } else {
        $(this).removeClass('is-invalid');
    }
});

// Actualización del Progreso
$('#registrarRequisicionForm input, #registrarRequisicionForm select').on('input change', function() {
    let completedSections = 0;
    // Sección Departamento
    if ($('#departamento').val() !== '') completedSections++;
    // Sección Artículo
    if (
        $('#tipo_articulo').val() !== '' &&
        $('#nombre_comercial').val() !== '' &&
        $('#cantidad').val() !== '' &&
        $('#unidad').val() !== ''
    ) completedSections++;
    // Sección Detalles
    if (
        $('#fecha_requerida').val() !== '' &&
        $('#prioridad').val() !== '' &&
        $('#estatus').val() !== ''
    ) completedSections++;
    $('#formProgress').text(completedSections + ' de 3 secciones completadas');
});

// Autocompletar dinámico para nombre comercial según tipo de artículo
const nombresPorTipo = {
    'Reactivo': ['Reactivo A', 'Reactivo B'],
    'Insumo': ['Insumo X', 'Insumo Y'],
    'Medicamento': ['Medicamento Y', 'Medicamento Z']
};

$('#tipo_articulo').on('change', function() {
    const tipo = $(this).val();
    const $datalist = $('#nombresComerciales');
    $datalist.empty();
    if (nombresPorTipo[tipo]) {
        nombresPorTipo[tipo].forEach(function(nombre) {
            $datalist.append($('<option>').val(nombre));
        });
    }
    $('#nombre_comercial').val('');
});

// Inicializar progreso al cargar
$(document).ready(function() {
    $('#formProgress').text('0 de 3 secciones completadas');
});
</script>